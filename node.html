<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conny V3 | Project View Prototype</title>
    <!-- Wir nutzen Vis.js f√ºr den Graphen -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!-- Phosphor Icons f√ºr moderne Optik -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* --- 1. DESIGN SYSTEM (CYBER-PHYSICAL) --- */
        :root {
            --bg: #0f172a;            /* Deep Space */
            --panel: #1e293b;        /* Surface */
            --border: #334155;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            
            /* Logic Colors */
            --accent-deep: #38bdf8;  /* Deep Dive (Logic) */
            --accent-connect: #4ade80; /* Connect (Social) */
            --accent-flow: #f472b6;  /* Flow (Media) */
            
            --private-color: #64748b; /* Private Node */
            --project-color: #f59e0b; /* Project Anchor (Amber) */
            --public-color: #f8fafc;  /* Public Hub */
        }

        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            overflow: hidden;
            height: 100vh;
            display: grid;
            grid-template-columns: 260px 1fr; /* Sidebar | Main */
            grid-template-rows: 60px 1fr;     /* Header | Content */
        }

        /* --- 2. LAYOUT COMPONENTS --- */
        
        /* HEADER (Omni-Search & Profile) */
        header {
            grid-column: 1 / -1;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        .breadcrumb { font-weight: 500; font-size: 1rem; display:flex; align-items:center; gap:10px; color: var(--text-muted); }
        .breadcrumb span { color: var(--text-main); font-weight: 700; }
        .breadcrumb i { font-size: 1.2rem; }

        /* OMNI-SEARCH */
        .omni-search-container {
            position: relative;
            width: 400px;
        }
        .omni-input {
            width: 100%;
            background: var(--panel);
            border: 1px solid var(--border);
            color: white;
            padding: 8px 40px 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .omni-input:focus {
            border-color: var(--accent-deep);
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
            outline: none;
        }
        .search-icon { position: absolute; right: 12px; top: 10px; color: var(--text-muted); }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .avatar {
            width: 32px; height: 32px; border-radius: 50%; background: var(--accent-deep);
            display: flex; align-items: center; justify-content: center; font-weight: bold; color: black;
        }

        /* SIDEBAR (Lenses) */
        aside {
            grid-row: 2 / -1;
            background: var(--panel);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px; /* Increased spacing between groups */
        }

        .lens-group-title {
            font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); font-weight: 700; margin-bottom: 10px; letter-spacing: 1px;
        }
        /* New style for main Navigation Headers */
        .nav-category {
            font-size: 0.95rem; font-weight: 600; color: white; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; cursor: pointer;
        }
        .nav-category:hover { color: var(--accent-deep); }
        
        .lens-item {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: 0.2s;
            font-size: 0.9rem;
        }
        .lens-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .lens-item.active { background: rgba(56, 189, 248, 0.1); color: var(--accent-deep); border-left: 3px solid var(--accent-deep); }
        .lens-item i { font-size: 1.1rem; }
        
        .lens-sub-item {
            padding-left: 34px; font-size: 0.85rem; color: var(--text-muted); display:flex; align-items:center; gap:8px; cursor:pointer; padding-top:5px; padding-bottom:5px; border-radius:4px;
        }
        .lens-sub-item:hover { color: white; background: rgba(255,255,255,0.03); }

        /* MAIN CONTENT AREA */
        main {
            grid-column: 2 / -1;
            grid-row: 2 / -1;
            position: relative;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            overflow: hidden;
        }

        /* --- 2.5 TOOLS PALETTE (NEW) --- */
        #tools-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px; /* Collapsed width */
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            gap: 10px;
            z-index: 60;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: width 0.2s;
        }
        #tools-panel:hover { width: 45px; } /* Slight expand effect */

        .tool-btn {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }
        .tool-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .tool-btn.active { color: #f59e0b; } /* Active Favorite/Pin color */
        
        .tool-separator { width: 20px; height: 1px; background: var(--border); margin: 5px 0; }
        
        /* Tooltips */
        .tool-btn::after {
            content: attr(data-tooltip);
            position: absolute; left: 45px; top: 50%; transform: translateY(-50%);
            background: black; color: white; padding: 4px 8px; border-radius: 4px;
            font-size: 0.7rem; white-space: nowrap; pointer-events: none;
            opacity: 0; transition: 0.2s; visibility: hidden;
        }
        .tool-btn:hover::after { opacity: 1; visibility: visible; }

        /* --- 3. MODES (VIEW SWITCHER) --- */
        .mode-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 4px;
            display: flex;
            gap: 4px;
            z-index: 50;
        }
        .mode-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            display: flex; align-items: center; gap: 6px;
            transition: 0.3s;
        }
        .mode-btn:hover { color: white; }
        
        /* Mode Active States */
        .mode-btn.active-deep { background: rgba(56, 189, 248, 0.2); color: var(--accent-deep); }
        .mode-btn.active-connect { background: rgba(74, 222, 128, 0.2); color: var(--accent-connect); }
        .mode-btn.active-flow { background: rgba(244, 114, 182, 0.2); color: var(--accent-flow); }

        /* --- 3.0 CONTEXT TOOLS (OWNER ONLY) --- */
        #context-tools {
            position: absolute;
            top: 70px; /* Below Mode Switcher */
            right: 20px;
            width: 320px;
            background: #172033; /* Slightly different bg */
            border: 1px solid var(--project-color); /* Owner Color */
            border-radius: 12px;
            z-index: 48;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: max-height 0.3s ease-in-out;
            overflow: hidden;
            max-height: 42px; /* Minimized by default */
        }
        #context-tools.expanded { max-height: 150px; }

        .ctx-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px; height: 42px; cursor: pointer;
            background: rgba(245, 158, 11, 0.1); /* Subtle Gold Tint */
        }
        .ctx-label { font-size: 0.8rem; font-weight: 700; color: var(--project-color); display:flex; align-items:center; gap:6px;}
        
        .ctx-body {
            padding: 10px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }
        
        .ctx-action-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            padding: 8px; border-radius: 6px; font-size: 0.8rem; color: var(--text-muted);
            cursor: pointer; display: flex; align-items: center; gap: 6px;
            transition: 0.2s;
        }
        .ctx-action-btn:hover { background: rgba(255,255,255,0.1); color: white; border-color: var(--text-muted); }

        /* --- 3.1 COMMUNICATION PANEL --- */
        #comm-panel {
            position: absolute;
            top: 125px; /* Moved down to make space for context tools */
            right: 20px;
            width: 320px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            z-index: 45; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: max-height 0.3s ease-in-out;
            overflow: hidden;
            max-height: 400px;
        }
        
        #comm-panel.minimized {
            max-height: 42px; /* Header only */
        }

        .comm-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0,0,0,0.2);
            padding: 0 5px;
            height: 42px;
            border-bottom: 1px solid var(--border);
        }

        .comm-tabs {
            display: flex;
            gap: 2px;
        }

        .comm-tab {
            padding: 10px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            color: var(--text-muted);
            border-bottom: 2px solid transparent;
            font-weight: 600;
        }
        .comm-tab:hover { color: white; }
        .comm-tab.active {
            color: var(--accent-deep);
            border-bottom-color: var(--accent-deep);
        }

        .comm-toggle {
            color: var(--text-muted);
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .comm-toggle:hover { color: white; }

        .comm-body {
            flex: 1;
            padding: 15px;
            display: none;
            overflow-y: auto;
            height: 250px;
            background: rgba(0,0,0,0.1);
        }
        .comm-body.active { display: flex; flex-direction: column; }

        /* Chat Bubbles Mockup */
        .chat-bubble {
            background: rgba(255,255,255,0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }
        .chat-meta { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 2px; display:flex; justify-content:space-between;}

        /* --- 4. VIEW CONTAINERS --- */
        .view-container {
            width: 100%; height: 100%; display: none; /* Hidden by default */
        }
        .view-container.active { display: block; animation: fadeIn 0.3s; }

        /* Deep Dive: VisJS */
        #graph-container { width: 100%; height: 100%; }

        /* Connect: Mock Map */
        #map-container { 
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/Vienna_city_districts_map.svg'); /* Mockup Map */
            background-size: cover; background-position: center;
            position: relative; filter: grayscale(80%) invert(90%);
        }
        .map-pin {
            position: absolute; width: 40px; height: 40px; background: var(--accent-connect);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #0f172a; font-weight: bold; border: 2px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            animation: pulse 2s infinite; cursor: pointer;
        }
        .map-pin.project-loc { background: var(--project-color); color:white; border-color:white; animation: none; }
        .map-pin img { width: 36px; height: 36px; border-radius: 50%; }

        /* Flow: Cards */
        #flow-container { padding: 40px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .flow-card {
            background: var(--panel); border: 1px solid var(--border); border-radius: 16px; overflow: hidden;
            transition: transform 0.2s; cursor: pointer;
        }
        .flow-card:hover { transform: translateY(-5px); border-color: var(--accent-flow); }
        .card-img { height: 160px; background: #334155; display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 3rem;}
        .card-body { padding: 15px; }
        .card-tag { font-size: 0.7rem; color: var(--accent-flow); text-transform: uppercase; font-weight: bold; }
        .card-warning { font-size: 0.7rem; color: #facc15; display: flex; align-items: center; gap: 4px; margin-top: 5px; background: rgba(250, 204, 21, 0.1); padding: 4px; border-radius: 4px;}

        /* --- 5. RADAR (Overlay) --- */
        #radar-panel {
            position: absolute; bottom: 20px; left: 20px;
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 300px;
            padding: 15px;
            backdrop-filter: blur(10px);
            z-index: 90;
            transform: translateY(120%); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #radar-panel.open { transform: translateY(0); }
        .radar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .radar-title { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--accent-deep); font-weight: bold; display: flex; align-items: center; gap: 6px;}
        
        .radar-item {
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 8px;
            font-size: 0.85rem; cursor: pointer; border-left: 2px solid transparent;
        }
        .radar-item:hover { background: rgba(255,255,255,0.1); }
        .radar-item.global { border-color: var(--public-color); }
        .radar-item.local { border-color: var(--accent-connect); }
        .radar-item.social { border-color: #f472b6; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); } 100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); } }

        /* --- 6. TUTORIAL POPUP (Ported from Dashboard) --- */
        #tutorial-popup {
            position: fixed;
            top: 100px;
            right: 50px;
            width: 320px;
            background: white;
            color: #0f172a;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            z-index: 1000;
            overflow: hidden;
            animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transition: height 0.3s ease;
        }
        .popup-header {
            background: linear-gradient(90deg, var(--accent-deep), #3b82f6);
            padding: 12px 15px;
            color: white;
            font-weight: bold;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .popup-body { padding: 20px; }
        .popup-footer {
            padding: 15px 20px;
            background: #f1f5f9;
            border-top: 1px solid #e2e8f0;
            text-align: right;
        }
        .btn-tutorial {
            background: #0f172a; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; font-size: 0.9rem;
        }
        .btn-tutorial:hover { background: #334155; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    </style>
</head>
<body>

    <!-- 1. HEADER (Breadcrumbs & Context) -->
    <header>
        <div class="breadcrumb">
            <i class="ph ph-house" style="cursor:pointer; color:var(--text-muted);" onclick="window.location.href='tour.html'"></i>
            <i class="ph ph-caret-right"></i>
            <span style="display:flex; align-items:center; gap:5px;">
                <i class="ph ph-projector-screen" style="color:var(--project-color);"></i> 
                Projekt: Regal Plan
            </span>
        </div>
        
        <div class="omni-search-container">
            <i class="ph ph-magnifying-glass search-icon"></i>
            <input type="text" class="omni-input" placeholder="Suche in diesem Projekt...">
        </div>

        <div class="user-profile">
            <div style="text-align:right; margin-right:10px;">
                <div style="font-weight:bold;">Martin</div>
                <div style="font-size:0.7rem; color:var(--text-muted);">Rep: 85 (Handwerk)</div>
            </div>
            <div class="avatar">M</div>
        </div>
    </header>

    <!-- 2. SIDEBAR (Navigation & Lenses) -->
    <aside>
        <!-- Block 1: Navigation -->
        <div>
            <div class="lens-group-title">Navigation</div>
            <div class="nav-category" onclick="window.location.href='tour.html'">
                <i class="ph ph-house-line"></i> Home
            </div>
            <div class="lens-item" onclick="switchLens(this, 'mynodes')">
                <i class="ph ph-tree-structure"></i> Meine Nodes/Hubs
            </div>
            <div class="lens-item" onclick="switchLens(this, 'favorites')">
                <i class="ph ph-star"></i> Favoriten
            </div>
            <div class="lens-item" onclick="switchLens(this, 'history')">
                <i class="ph ph-clock-counter-clockwise"></i> Verlauf
            </div>
            
            <div class="lens-sub-item" style="margin-top:5px; color:var(--accent-deep);" onclick="alert('Dialog: Neuen Node erstellen')">
                <i class="ph ph-plus-circle"></i> Node erstellen...
            </div>
        </div>

        <!-- Block 2: Context Lenses -->
        <div>
            <div class="lens-group-title">Context Lenses</div>
            <div class="lens-item active" onclick="switchLens(this, 'work')"><i class="ph ph-briefcase"></i> Work</div>
            <div class="lens-item" onclick="switchLens(this, 'social')"><i class="ph ph-users"></i> Social</div>
            <div class="lens-item" onclick="switchLens(this, 'regional')"><i class="ph ph-map-pin"></i> Regional</div>
            <div class="lens-item" onclick="switchLens(this, 'private')"><i class="ph ph-lock-key"></i> Private Only</div>
            
            <div class="lens-sub-item" style="margin-top:5px; color:var(--accent-deep);">
                <i class="ph ph-plus-circle"></i> Custom Lens...
            </div>
        </div>

        <!-- Block 3: Topic Lenses (Bookmarks) -->
        <div>
            <div class="lens-group-title">Topic Lenses (Bookmarks)</div>
            <div class="lens-item active" onclick="switchLens(this, 'project')" style="border-left-color:var(--project-color); color:var(--project-color);">
                <i class="ph ph-bookmark-simple"></i> Regal-Projekt
            </div>
            <div class="lens-item"><i class="ph ph-hash"></i> Handwerk</div>
            <div class="lens-item" onclick="window.location.href='klima.html'"><i class="ph ph-hash"></i> Klimawandel</div>
        </div>
    </aside>

    <!-- 3. MAIN AREA -->
    <main>
        
        <!-- TOOLS PALETTE (NEW) -->
        <div id="tools-panel">
            <!-- Actions -->
            <div class="tool-btn active" data-tooltip="Als Bookmark pinnen" onclick="toggleTool(this)">
                <i class="ph ph-push-pin"></i>
            </div>
            <div class="tool-btn" data-tooltip="Zu Favoriten hinzuf√ºgen" onclick="toggleTool(this)">
                <i class="ph ph-star"></i>
            </div>
            
            <div class="tool-separator"></div>
            
            <!-- Project Tools -->
            <div class="tool-btn" data-tooltip="Tasks & Kanban">
                <i class="ph ph-kanban"></i>
            </div>
            <div class="tool-btn" data-tooltip="Files & Assets">
                <i class="ph ph-files"></i>
            </div>
            <div class="tool-btn" data-tooltip="Settings">
                <i class="ph ph-gear"></i>
            </div>

            <div class="tool-separator"></div>

            <!-- Advanced / Governance -->
             <div class="tool-btn" data-tooltip="Fork erstellen" onclick="alert('Fork Dialog: Kopiere diesen Hub...')">
                <i class="ph ph-git-fork"></i>
            </div>
             <div class="tool-btn" data-tooltip="KI anpassen" onclick="alert('AI Config: Mediator-Pers√∂nlichkeit einstellen...')">
                <i class="ph ph-robot"></i>
            </div>
        </div>

        <!-- MODE SWITCHER (FLOATING) -->
        <div class="mode-switcher">
            <button class="mode-btn active-deep" onclick="setMode('deep')">
                <i class="ph ph-brain"></i> Deep Dive
            </button>
            <button class="mode-btn" onclick="setMode('connect')">
                <i class="ph ph-users-three"></i> Connect
            </button>
            <button class="mode-btn" onclick="setMode('flow')">
                <i class="ph ph-film-strip"></i> Flow
            </button>
        </div>

        <!-- OWNER CONTEXT TOOLS (NEW) -->
        <div id="context-tools">
            <div class="ctx-header" onclick="toggleContextPanel()">
                <div class="ctx-label"><i class="ph ph-crown"></i> Owner Tools</div>
                <i class="ph ph-caret-down" id="ctx-toggle-icon"></i>
            </div>
            <div class="ctx-body">
                <div class="ctx-action-btn"><i class="ph ph-tree-structure"></i> Sub-Node</div>
                <div class="ctx-action-btn"><i class="ph ph-link"></i> Link Hub</div>
                <div class="ctx-action-btn"><i class="ph ph-shield"></i> Privacy</div>
                <div class="ctx-action-btn"><i class="ph ph-robot"></i> AI Gov</div>
            </div>
        </div>

        <!-- COMMUNICATION PANEL -->
        <div id="comm-panel">
            <div class="comm-header">
                <div class="comm-tabs">
                    <div class="comm-tab active" onclick="switchCommTab('notes')">Notizen üîí</div>
                    <div class="comm-tab" onclick="switchCommTab('hub')">Hub-Chat</div>
                    <div class="comm-tab" onclick="switchCommTab('dms')">DMs</div>
                </div>
                <div class="comm-toggle" onclick="toggleCommPanel()">
                    <i class="ph ph-caret-up" id="comm-icon"></i>
                </div>
            </div>
            
            <!-- Tab: Notes -->
            <div id="comm-notes" class="comm-body active">
                <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:10px;">
                    <i class="ph ph-lock-key"></i> Private Notizen zu diesem Projekt. Nur f√ºr dich sichtbar.
                </div>
                <textarea style="width:100%; height:100%; flex:1; background:rgba(0,0,0,0.3); border:1px solid var(--border); color:white; border-radius:4px; padding:8px; resize:none; font-family:inherit;" placeholder="- Ma√üe nochmal pr√ºfen...&#10;- Holzart ausw√§hlen..."></textarea>
            </div>

            <!-- Tab: Hub Chat -->
            <div id="comm-hub" class="comm-body">
                 <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:10px; border-bottom:1px solid var(--border); padding-bottom:5px;">
                    <i class="ph ph-users"></i> √ñffentlicher Chat: "Regal Plan"
                </div>
                
                <div class="chat-bubble">
                    <div class="chat-meta"><span>Lukas</span> <span>10:30</span></div>
                    Bin morgen ab 14h in der Werkstatt, falls du Hilfe brauchst!
                </div>
                <div class="chat-bubble" style="background:rgba(56, 189, 248, 0.1); border:1px solid rgba(56, 189, 248, 0.3);">
                    <div class="chat-meta"><span style="color:var(--accent-deep);">Du</span> <span>10:32</span></div>
                    Super, ich bring die Skizzen mit.
                </div>
                
                <input type="text" placeholder="Nachricht schreiben..." style="background:rgba(0,0,0,0.3); border:1px solid var(--border); color:white; border-radius:4px; padding:8px; margin-top:auto;">
            </div>

            <!-- Tab: DMs -->
            <div id="comm-dms" class="comm-body">
                <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:10px;">
                    <i class="ph ph-chats-teardrop"></i> Verschl√ºsselte Direktnachrichten
                </div>
                
                <div style="display:flex; align-items:center; gap:10px; padding:10px; background:rgba(255,255,255,0.05); border-radius:8px; cursor:pointer; margin-bottom:5px;">
                     <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lukas" style="width:30px; height:30px; border-radius:50%;">
                     <div>
                         <div style="font-size:0.85rem; font-weight:bold;">Lukas</div>
                         <div style="font-size:0.75rem; color:var(--text-muted);">Hast du das Holz schon?</div>
                     </div>
                </div>
                
                <div style="display:flex; align-items:center; gap:10px; padding:10px; border-radius:8px; cursor:pointer; opacity:0.6;">
                     <div style="width:30px; height:30px; border-radius:50%; background:#334155; display:flex; justify-content:center; align-items:center;">JD</div>
                     <div>
                         <div style="font-size:0.85rem; font-weight:bold;">Jane Doe</div>
                         <div style="font-size:0.75rem; color:var(--text-muted);">Stake-Anfrage...</div>
                     </div>
                </div>
            </div>
        </div>

        <!-- VIEW A: DEEP DIVE (GRAPH) -->
        <div id="graph-container" class="view-container active"></div>

        <!-- VIEW B: CONNECT (MAP) -->
        <div id="map-container" class="view-container">
            <!-- Project Location (Center) -->
            <div class="map-pin project-loc" style="top:42%; left:52%; width:50px; height:50px; font-size:1.5rem;" title="Projekt Ort: Zuhause/Werkstatt">
                <i class="ph ph-house-line"></i>
            </div>

            <!-- Context Pins -->
            <div class="map-pin" style="top:40%; left:50%; width:30px; height:30px;" title="Hub: Offene Werkstatt">
                <i class="ph ph-wrench" style="font-size:1rem;"></i>
            </div>
            <div class="map-pin" style="top:45%; left:60%; background:#f472b6;" title="Lukas (Mitglied)">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lukas" alt="Lukas">
            </div>
            
            <div style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); padding:10px 20px; border-radius:20px; font-size:0.8rem;">
                <i class="ph ph-info"></i> Project Context: Wer & Wo?
            </div>
        </div>

        <!-- VIEW C: FLOW (CARDS) -->
        <div id="flow-container" class="view-container">
            <!-- Cards generated via JS -->
        </div>

        <!-- RADAR OVERLAY -->
        <div id="radar-panel">
            <div class="radar-header">
                <span class="radar-title"><i class="ph ph-radar"></i> Context Radar</span>
                <i class="ph ph-x" style="cursor:pointer;" onclick="toggleRadar(false)"></i>
            </div>
            <div class="radar-item global" onclick="addGhostNode('global')">
                <div style="font-weight:bold;">üåç Global Gravity</div>
                <div style="color:var(--text-muted); font-size:0.75rem;">Verbinde mit "DIY Furniture Hub"</div>
            </div>
            <div class="radar-item local" onclick="addGhostNode('local')">
                <div style="font-weight:bold;">üìç Local Proximity</div>
                <div style="color:var(--text-muted); font-size:0.75rem;">Offene Werkstatt (2km)</div>
            </div>
            <div class="radar-item social" onclick="addGhostNode('social')">
                <div style="font-weight:bold;">üë• Social Echo</div>
                <div style="color:var(--text-muted); font-size:0.75rem;">Lukas: "Holzreste abzugeben"</div>
            </div>
        </div>

    </main>

    <!-- TUTORIAL POPUP (DRAGGABLE & MINIMIZABLE) -->
    <div id="tutorial-popup">
        <div class="popup-header" id="popup-drag-handle">
            <span>üéì Project Guide</span>
            <!-- Minimize Button -->
            <i id="minimize-btn" class="ph ph-minus" style="cursor:pointer;" onclick="toggleMinimize()"></i>
        </div>
        <div class="popup-body" id="popup-content">
            <p style="margin-top:0;"><b>Project View</b> Aktiv</p>
            <p style="font-size:0.9rem; color:#475569;">
                Du befindest dich im Node "Regal Plan". Hier laufen alle F√§den zusammen.
            </p>
            <ul style="font-size:0.85rem; color:#475569; padding-left:20px;">
                <li>Zentrum: Dein Projekt-Anchor</li>
                <li>Radar: Klicke auf den zentralen Node</li>
                <li>Tabs: Wechsle zwischen Graph, Map & Feed</li>
            </ul>
        </div>
        <div class="popup-footer" id="popup-footer">
            <a href="tour.html" class="btn-tutorial">Zur√ºck zum Dashboard &rarr;</a>
        </div>
    </div>

    <script>
        // --- 1. DATA SIMULATION (PROJECT CENTERED) ---
        const avatarMe = "https://api.dicebear.com/7.x/avataaars/svg?seed=Martin1&backgroundColor=b6e3f4";
        
        // Nodes (Centered around PROJECT)
        const nodesData = [
            // PROJECT ANCHOR (Center of Gravity)
            { id: 'project_root', label: 'PROJEKT:\nBauplan Regal', shape: 'hexagon', size: 50, borderWidth: 4, color:{background:'#0f172a', border:'#f59e0b'}, font:{color:'#f59e0b', size:16}, group:'project' },
            
            // Participants (Anchors linked to project)
            { id: 'me', label: 'Martin\n(Owner)', shape: 'circularImage', image: avatarMe, size: 25, color:{border:'#38bdf8'}, group:'anchor' },
            { id: 'friend1', label: 'Lukas\n(Collab)', shape: 'circularImage', image: "https://api.dicebear.com/7.x/avataaars/svg?seed=Lukas", size:25, group:'social' },

            // Project Content (Children)
            { id: 'note1', label: 'Material-\nliste üîí', group:'private' },
            { id: 'task1', label: 'Task:\nHolz kaufen', shape:'box', color:{background:'#1e293b', border:'#f59e0b'}, font:{color:'#f59e0b'} },
            
            // External/Hub Links
            { id: 'hub1', label: 'HUB:\nWerkstatt', group:'hub', value: 20, title:'Regional Hub' },
            { id: 'media1', label: 'Inspo:\nPinterest', shape:'square', color:{background:'#f472b6'}, font:{color:'white'} }
        ];

        // Edges (Links)
        const edgesData = [
            // Ownership & Social
            { from: 'me', to: 'project_root', label:'owns', color:{color:'#38bdf8'}, arrows:'to' },
            { from: 'friend1', to: 'project_root', label:'contributes', color:{color:'#4ade80'} },
            
            // Structure
            { from: 'project_root', to: 'note1', label:'contains', color:{color:'#64748b'} },
            { from: 'project_root', to: 'task1', label:'next_action', color:{color:'#f59e0b'} },
            { from: 'project_root', to: 'media1', label:'refers_to', dashes:true },
            
            // Context Links (Ghost/Radar results already accepted)
            { from: 'project_root', to: 'hub1', label:'located_at', dashes:true }
        ];

        // Flow Content (Specific to this Project)
        const flowData = [
            { title: "Inspiration: Industrial Style", tag: "#Design", img: "üèóÔ∏è", warning: false },
            { title: "Tutorial: Unsichtbare Verbindungen", tag: "#Tech", img: "üî©", warning: false },
            { title: "Mein Skizzen-Upload", tag: "#Upload", img: "üìù", warning: false },
            { title: "Warnung: Billiges Holz", tag: "#Fail", img: "‚ö†Ô∏è", warning: true, warningText: "Widerlegt: Nicht stabil" },
        ];

        // --- 2. LOGIC ---
        let network;
        let nodes, edges;

        function init() {
            // Setup Vis.js
            nodes = new vis.DataSet(nodesData);
            edges = new vis.DataSet(edgesData);
            
            const container = document.getElementById('graph-container');
            const data = { nodes: nodes, edges: edges };
            const options = {
                nodes: {
                    font: { color: '#cbd5e1', face: 'Inter' },
                    borderWidth: 2,
                    shadow: true
                },
                groups: {
                    project: {
                        shape: 'hexagon',
                        color: { background: '#0f172a', border: '#f59e0b' }
                    },
                    private: { 
                        shape: 'dot', 
                        color: { background: '#1e293b', border: '#64748b' }, 
                        shapeProperties: { borderDashes: [5,5] } 
                    },
                    hub: { 
                        shape: 'hexagon', 
                        color: { background: '#0f172a', border: '#38bdf8' },
                        borderWidth: 3
                    },
                    social: {
                        color: { border: '#4ade80' },
                        borderWidth: 3
                    }
                },
                edges: {
                    color: '#475569',
                    arrows: 'to',
                    smooth: { type: 'cubicBezier' }
                },
                physics: {
                    stabilization: false,
                    barnesHut: { gravitationalConstant: -4000 }
                },
                interaction: { hover: true }
            };

            network = new vis.Network(container, data, options);

            // Simulation: Trigger Radar when clicking Project Root
            network.on("click", function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    if(nodeId === 'project_root') {
                        toggleRadar(true);
                    }
                } else {
                    toggleRadar(false);
                }
            });

            // Init Flow
            renderFlow();
        }

        // --- 3. MODE SWITCHING ---
        function setMode(mode) {
            // 1. Update Buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.className = 'mode-btn'; // Reset
            });
            document.querySelector(`.mode-btn[onclick="setMode('${mode}')"]`).classList.add(
                mode === 'deep' ? 'active-deep' : 
                mode === 'connect' ? 'active-connect' : 'active-flow'
            );

            // 2. Switch Containers
            document.querySelectorAll('.view-container').forEach(el => el.classList.remove('active'));
            
            if(mode === 'deep') document.getElementById('graph-container').classList.add('active');
            if(mode === 'connect') document.getElementById('map-container').classList.add('active');
            if(mode === 'flow') document.getElementById('flow-container').classList.add('active');
        }

        // --- 3.0 CONTEXT TOOLS LOGIC ---
        function toggleContextPanel() {
            const p = document.getElementById('context-tools');
            const icon = document.getElementById('ctx-toggle-icon');
            p.classList.toggle('expanded');
            
            if(p.classList.contains('expanded')) {
                icon.classList.replace('ph-caret-down', 'ph-caret-up');
            } else {
                icon.classList.replace('ph-caret-up', 'ph-caret-down');
            }
        }

        // --- 3.1 COMM PANEL LOGIC ---
        function switchCommTab(tab) {
            // UI Update Tabs
            document.querySelectorAll('.comm-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.comm-tab[onclick="switchCommTab('${tab}')"]`).classList.add('active');

            // UI Update Content
            document.querySelectorAll('.comm-body').forEach(b => b.classList.remove('active'));
            document.getElementById('comm-' + tab).classList.add('active');
        }

        function toggleCommPanel() {
            const p = document.getElementById('comm-panel');
            const icon = document.getElementById('comm-icon');
            p.classList.toggle('minimized');
            
            if(p.classList.contains('minimized')) {
                icon.classList.replace('ph-caret-up', 'ph-caret-down');
            } else {
                icon.classList.replace('ph-caret-down', 'ph-caret-up');
            }
        }

        // --- 3.2 TOOLS TOGGLE ---
        function toggleTool(el) {
            el.classList.toggle('active');
        }

        // --- 4. RADAR ACTIONS ---
        function toggleRadar(show) {
            const el = document.getElementById('radar-panel');
            if(show) el.classList.add('open');
            else el.classList.remove('open');
        }

        function addGhostNode(type) {
            let newNode;
            if(type === 'global') {
                newNode = { id: 'ghost_global', label: 'HUB:\nGlobal Woodworking', group: 'hub', opacity:0.7, x: 200, y:-200 };
                edges.add({ from: 'project_root', to: 'ghost_global', label: 'belongs_to', dashes:true });
            } else if (type === 'local') {
                newNode = { id: 'ghost_local', label: 'Baumarkt\nWien Mitte', group: 'hub', color:{border:'#4ade80'}, x: -100, y: 200 };
                edges.add({ from: 'project_root', to: 'ghost_local', label: 'near', dashes:true });
            } else {
                alert("Lukas sagt: 'Hey, ich hab Eiche √ºbrig!'");
                return; 
            }
            
            try { nodes.add(newNode); } catch(e){}
            toggleRadar(false);
        }

        // --- 5. LENS SWITCHING (VISUAL FILTER) ---
        function switchLens(el, lens) {
            if(lens === 'home') {
                window.location.href='tour.html';
                return;
            }
            document.querySelectorAll('.lens-item').forEach(i => i.classList.remove('active'));
            if(el.classList.contains('lens-item')) el.classList.add('active');

            // Simulierter Filter-Effekt
            if(lens === 'private') {
                nodes.update([{id:'hub1', hidden:true}, {id:'friend1', hidden:true}]);
            } else {
                nodes.update([{id:'hub1', hidden:false}, {id:'friend1', hidden:false}]);
            }
        }

        // --- 6. RENDER FLOW ---
        function renderFlow() {
            const container = document.getElementById('flow-container');
            container.innerHTML = flowData.map(item => `
                <div class="flow-card">
                    <div class="card-img">${item.img}</div>
                    <div class="card-body">
                        <div class="card-tag">${item.tag}</div>
                        <div style="font-weight:bold; margin-top:5px;">${item.title}</div>
                        ${item.warning ? `<div class="card-warning"><i class="ph ph-warning"></i> ${item.warningText}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // --- 7. POPUP LOGIC (Added) ---
        const popup = document.getElementById("tutorial-popup");
        const handle = document.getElementById("popup-drag-handle");
        
        let isDragging = false;
        let startX, startY, initialLeft, initialTop;

        handle.addEventListener("mousedown", (e) => {
            if(e.target.id === 'minimize-btn') return;
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            const rect = popup.getBoundingClientRect();
            initialLeft = rect.left;
            initialTop = rect.top;
            popup.style.right = "auto"; 
            popup.style.left = initialLeft + "px";
            popup.style.top = initialTop + "px";
            handle.style.cursor = "grabbing";
        });

        document.addEventListener("mousemove", (e) => {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            popup.style.left = `${initialLeft + dx}px`;
            popup.style.top = `${initialTop + dy}px`;
        });

        document.addEventListener("mouseup", () => {
            isDragging = false;
            handle.style.cursor = "move";
        });

        function toggleMinimize() {
            const content = document.getElementById('popup-content');
            const footer = document.getElementById('popup-footer');
            const btn = document.getElementById('minimize-btn');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                footer.style.display = 'block';
                btn.classList.remove('ph-plus');
                btn.classList.add('ph-minus');
            } else {
                content.style.display = 'none';
                footer.style.display = 'none';
                btn.classList.remove('ph-minus');
                btn.classList.add('ph-plus');
            }
        }

        // Boot
        window.onload = init;

    </script>
</body>
</html>